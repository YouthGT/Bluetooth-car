C51 COMPILER V9.57.0.0   MAIN                                                              05/16/2021 16:47:02 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg52.h>
   2          #include<Car_Init.h>
   3          #include<Com_Init.h>
   4          #define uchar unsigned char
   5          #define uint unsigned int
   6                  
   7          //PWM输出(控制舵机)
   8          sbit SEH_PWM =P3^3;
   9          sbit SEV_PWM =P3^4;
  10          
  11          uchar temp;            //temp储存蓝牙串口收到的信息
  12          uchar count=0;           //0.5ms次数标识
  13          uchar SEH_count=15;
  14          uchar SEV_count=15;         //舵机角度标识
  15          
  16          void main()
  17          {
  18   1              Car_Init();
  19   1              Com_Init();
  20   1            while(1);
  21   1      }
  22          
  23          void Timer0_Int() interrupt 1     //定时器0工作方式1 16位定时计数（PWM）
  24          {
  25   1              TH0  = 0xff;            
  26   1              TL0  = 0xa4;
  27   1                      //舵机1
  28   1                      if(count <= SEH_count) //控制占空比左右
  29   1                              {
  30   2                                      SEH_PWM = 1;//如果count的计数小于（5-25）也就是0.5ms-2.5ms则这段小t周期持续高电平。产生方波
  31   2                              }
  32   1                      else
  33   1                              {
  34   2                                      SEH_PWM = 0;
  35   2                              }
  36   1                      //舵机2
  37   1                      if(count <= SEV_count) //控制占空比上下
  38   1                              {
  39   2                                      SEV_PWM = 1;
  40   2                              }
  41   1                      else
  42   1                              {
  43   2                                      SEV_PWM = 0;
  44   2                              }
  45   1                      count++;
  46   1                      if (count >= 200) //T = 20ms则定时器计数变量清0
  47   1                              {
  48   2                                      count = 0;
  49   2                              }
  50   1      }
  51          
  52          void uart_ser() interrupt 4
  53          {
  54   1           if (RI == 0)
C51 COMPILER V9.57.0.0   MAIN                                                              05/16/2021 16:47:02 PAGE 2   

  55   1                      {
  56   2                              return;
  57   2                      }
  58   1           ES = 0;
  59   1           RI = 0;
  60   1           temp = SBUF; //将接收到的数据传给command
  61   1               switch(temp)
  62   1                                      {
  63   2                                              case 0x00: stop(); break; 
  64   2                                              case 0x01: go(); break;
  65   2                                              case 0x02: back(); break;
  66   2                                              case 0x03: left(); break;
  67   2                                              case 0x04: right(); break;
  68   2                                              case 0x05://舵机向上转
  69   2                                                      {
  70   3                                                              SEV_count++;
  71   3                                                              if(SEV_count >= 25)
  72   3                                                                      {
  73   4                                                                              SEV_count = 25;//保持180度
  74   4                                                                      }
  75   3                                                              count = 0; //占空比参数t改变，让定时器重新计数
  76   3                                                              break;
  77   3                                                      }   
  78   2                                              case 0x06://舵机下降
  79   2                                                      {
  80   3                                                              SEV_count--;
  81   3                                                              if(SEV_count <= 5)
  82   3                                                                      {
  83   4                                                                              SEV_count = 5; //保持0度
  84   4                                                                      }
  85   3                                                              count = 0;
  86   3                                                              break;
  87   3                                                      }   
  88   2                                              case 0x07://开
  89   2                                                      {
  90   3                                                              SEH_count++;
  91   3                                                              if(SEH_count >= 15)
  92   3                                                                      {
  93   4                                                                              SEH_count = 15; //保持90度 
  94   4                                                                      }
  95   3                                                              count = 0;
  96   3                                                              break;
  97   3                                                      }   
  98   2                                              case 0x08://合
  99   2                                                      {
 100   3                                                              SEH_count--;
 101   3                                                              if(SEH_count <= 5) //保持0度
 102   3                                                                      {
 103   4                                                                              SEH_count = 5;
 104   4                                                                      }
 105   3                                                              count = 0;
 106   3                                                              break;
 107   3                                                      }
 108   2                                              case 0x09:  //舵机复位
 109   2                                                      {
 110   3                                                              SEH_count = 15;
 111   3                                                              SEV_count = 15;
 112   3                                                              count = 0;
 113   3                                                              break;
 114   3                                                      }
 115   2                                              }
 116   1          ES = 1; //打开串口
C51 COMPILER V9.57.0.0   MAIN                                                              05/16/2021 16:47:02 PAGE 3   

 117   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    373    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
